language: rust
rust:
- stable
- beta
- nightly
sudo: false
cache:
  apt: true
  pip: true
  directories:
  - target/debug/deps
  - target/debug/build
  - target/release/deps
  - target/release/build
install:
- pip install 'travis-cargo<0.2' --user
- pip install 'ghp-import' --user
- export PATH=$HOME/.local/bin:$PATH
addons:
  apt:
    packages:
    - postfix
    - libcurl4-openssl-dev
    - libelf-dev
    - libdw-dev
before_script:
- smtp-sink 2525 1000&
script:
- travis-cargo build
- travis-cargo test
after_success: |
  travis-cargo --only nightly bench &&
  travis-cargo --only stable coveralls --no-sudo &&
  [ $TRAVIS_BRANCH = master ] &&
  [ $TRAVIS_PULL_REQUEST = false ] &&
  [ $TRAVIS_RUST_VERSION = stable ] &&
  cargo doc --no-deps &&
  ghp-import -n target/doc &&
  git push -fq https://${GH_TOKEN}@github.com/lettre/lettre.github.io.git master
env:
  global:
  - secure: W2N2OUB2i6dqDhxbsRpanpOdjrLwDKx7FY03ni4dkMnJ1az79gwgxZidq30L8afBhs1E50ug6CCdTYyI9KQfamg2vGgD8FkvtEgh2zsm6xTlfr7aRtOEYBbBJM6B8x+oJtdvzszlf8Awm/ShQ7ZpEeUnBLrL3LfArIVinv8DGAOxWTurlD7OPaSCktyasW2VGx7DtL1Kj3gP61ag1/1GxoyWdhFIDJX4Hn83De0wkp/He2BHA/xV7nzg3mFUsn2hXzzhk/yYfluA6gdcCFZ7QTm2ZfeHy0qMyfS/8F7E65Mmw8asNAALs7tVYPbxRNF92IWwej0d1WmMnzHLuZ3ogA4ZE2Pbn10ZdfxpVKKcsyUl2WQSxSt1e7seXSYZZQdVgf9ajPTre4IeARKErPa1SVt2dNhuT+VkniRcIkDYsXDWLftu0bglYSR5VRL3ZdgG5hGneIxr4ezFgBrth6leTDB4S+cuJBVOs8/o9NsshaH6sTUYMi025yJDISI01grRmntBwleKPuyPzpHaXNiLXsBvjj2MPeDqMRzx44LnHjLIDRs0DRnfRh/z9QuzIwp2GuU2UoPZYp9NAKjjG7RLjCJkxyQ+q1Eiur9wMGPwMsU2ZMr+fferm8eImioJXyutvyzT2UP8frDpF/SCWD9+BV3I0J7xD1rLgy5qE0QgJBs=
